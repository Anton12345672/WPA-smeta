</label><select class="in-u"><option>pcs</option><option>m²</option><option>m</option><option>h</option></select></div>
            <div><label>Кол-во</label><input type="number" class="in-q" value="1"></div>
            <div><label>Закупка</label><input type="number" class="in-c" value="0"></div>
            <div><label>Продажа</label><input type="number" class="in-p" value="0"></div>
            <div class="calc-res" style="font-size:10px; color:green">...</div>
            <button onclick="this.parentElement.remove()" style="background:none; border:none; color:red; cursor:pointer;">✕</button>
        `;
        document.getElementById('items-list').appendChild(div);
    }

    function saveData() {
        const rows = document.querySelectorAll('.item-row');
        let tR = 0, tP = 0;
        rows.forEach(r => {
            const q = +r.querySelector('.in-q').value, p = +r.querySelector('.in-p').value, c = +r.querySelector('.in-c').value;
            tR += (q * p); tP += (q * (p - c));
        });
        db.push({ client: document.getElementById('c-name').value || 'New', date: new Date().toLocaleDateString(), total: tR, profit: tP });
        localStorage.setItem('estimates_v3', JSON.stringify(db));
        location.reload();
    }

    function render() {
        let sR = 0, sP = 0;
        db.forEach(s => {
            sR += s.total; sP += s.profit;
            document.getElementById('main-table').innerHTML += <tr><td><b>${s.client}</b></td><td>${s.date}</td><td>${s.total} €</td><td style="color:green">${s.profit} €</td></tr>;
        });
        document.getElementById('total-rev').innerText = sR + ' €';
        document.getElementById('total-prof').innerText = sP + ' €';
        document.getElementById('total-count').innerText = db.length;
    }
    render();
</script>
</body>
</html>
